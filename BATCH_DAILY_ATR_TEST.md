# 批量策略日线ATR功能测试指南

## 功能概述

批量策略生成现在支持为每个币种单独选择杠杆计算使用的ATR类型：
- **4小时ATR**：适合短期交易，杠杆相对较高（默认）
- **日线ATR**：更保守，适合长期持仓，杠杆较低

## 测试步骤

### 1. 准备测试数据

在批量策略表单中粘贴以下测试数据：

```
BTC 兜底区 95000
ETH 探顶区 3500
SOL 兜底区 200
DOGE 探顶区 0.4
PEPE 兜底区 0.000018
```

### 2. 解析数据

1. 点击"解析数据"按钮
2. 确认解析成功，显示5个币种的数据表格
3. 观察每个币种的"杠杆ATR类型"列，默认都是"4小时ATR"

### 3. 测试单个币种ATR类型选择

1. 为BTC选择"日线ATR（保守）"
2. 为ETH保持"4小时ATR"
3. 为SOL选择"日线ATR（保守）"
4. 为DOGE和PEPE保持"4小时ATR"

### 4. 测试批量设置功能

1. 在"批量策略配置"中展开配置选项
2. 在"批量设置杠杆ATR类型"中选择"日线ATR（保守）"
3. 观察所有币种的ATR类型都变为"日线ATR（保守）"
4. 再选择"4小时ATR"，观察所有币种都变回"4小时ATR"

### 5. 生成策略并验证结果

1. 设置不同的ATR类型组合：
   - BTC: 日线ATR
   - ETH: 4小时ATR
   - SOL: 日线ATR
   - DOGE: 4小时ATR
   - PEPE: 日线ATR

2. 点击"批量生成策略"

3. 在结果表格中验证：
   - 杠杆列显示正确的ATR类型标识
   - 使用日线ATR的币种杠杆应该更低（更保守）
   - 使用4小时ATR的币种杠杆应该相对较高
   - 鼠标悬停在杠杆标签上查看计算公式

### 6. 验证杠杆计算差异

对比同一币种使用不同ATR类型的杠杆差异：

1. 先用4小时ATR生成BTC策略，记录杠杆倍数
2. 清空结果，改为日线ATR重新生成BTC策略
3. 对比两次杠杆倍数，日线ATR应该产生更低的杠杆

## 预期结果

### 界面功能
- ✅ 表格中每个币种都有ATR类型选择下拉框
- ✅ 批量设置功能可以一键修改所有币种的ATR类型
- ✅ 选择器在处理过程中被禁用
- ✅ 格式说明包含ATR类型选择的说明

### 策略生成
- ✅ 使用日线ATR的币种杠杆更低（更保守）
- ✅ 使用4小时ATR的币种杠杆相对较高
- ✅ 结果表格正确显示ATR类型标识
- ✅ 杠杆计算公式显示使用的ATR类型

### 数据传递
- ✅ 每个币种的ATR类型选择正确传递给策略引擎
- ✅ 策略输出包含正确的leverageAtrType字段
- ✅ 批量结果显示正确的ATR类型信息

## 测试用例

### 用例1：默认行为
- 输入：标准批量数据
- 预期：所有币种默认使用4小时ATR

### 用例2：混合ATR类型
- 输入：部分币种使用日线ATR，部分使用4小时ATR
- 预期：每个币种使用各自选择的ATR类型计算杠杆

### 用例3：批量设置
- 输入：使用批量设置功能
- 预期：所有币种ATR类型同时更新

### 用例4：杠杆差异验证
- 输入：同一币种分别使用两种ATR类型
- 预期：日线ATR产生更低的杠杆倍数

## 注意事项

1. **向后兼容**：现有批量数据默认使用4小时ATR
2. **用户体验**：提供批量设置功能避免逐个修改
3. **数据一致性**：确保ATR类型选择正确传递到策略计算
4. **结果显示**：清楚标识每个策略使用的ATR类型

## 故障排除

如果遇到问题：
1. 检查浏览器控制台是否有错误
2. 确认后端API支持日线ATR数据
3. 验证策略引擎正确处理leverageAtrType参数
4. 检查结果表格的ATR类型显示逻辑
